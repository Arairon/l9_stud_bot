# Инструкция для разработчиков
Докеры, make и прочее пока для меня - тёмный лес, так что для разворачивания бота на своём железе придётся немного поработать руками.

# Джентельменский набор
- Git (кому-то из программистов вообще надо напоминать, что это нужно)
- Golang не ниже 1.20.6
- MySQL Server
- [wkhtmltopdf](https://wkhtmltopdf.org/downloads.html) - программа для конвертации расписания из HTML в картинку (далее будет расписано, что и куда качать)

## Если ещё нужен тестовый сервер для испытаний
(Внимание! Тестовые расписания имеют устаревшую вёрстку)
- Python не ниже 3.6
- Библиотеки для Python `pip install bs4 flask requests`

# Подготовка окружения
> Настоящий бот работает на Ubuntu 18.04.6 LTS x86-64

Клонируем основной репозиторий:

`git clone https://github.com/far-galaxy/l9_stud_bot.git`

Клонируем сервер, на котором будет работать тестовое расписание:

`git clone https://github.com/far-galaxy/l9_test_server.git`

На сайте [wkhtmltopdf](https://wkhtmltopdf.org/downloads.html) скачиваем версию для вашей рабочей машины 

## Windows:
- Выбираем **7z Archive**
- Открываем архив, копируем `/wkhtmltox/bin/wkhtmltoimage.exe` в папку с основным репозиторием

## Linux:
- Скачиваем .deb пакет под соответствующую платформу
- Открываем как архив, копируем `wkhtmltoimage` в папку с основным репозиторием (можно и установить)

Устанавливаем MySQL Server, настраиваем пользователя, создаём в ней базу данных.

[Настройка для Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-20-04)

В папке с основным репозиторием создаём файл `.env` или записываем в переменные окружения следующие данные:
```ini
TELEGRAM_APITOKEN=токен вашего бота в Telegram
MYSQL_USER=имя пользователя 
MYSQL_PASS=пароль
MYSQL_DB=база данных
WK_PATH="./wkhtmltoimage" (путь до исполняемого файла wkhtmltoimage)
TELEGRAM_TEST_USER=ваш ID в Telegram (длинное число, не путать с ником)
START_WEEK=34 (неделя в году, когда начинается семестр)
NOTIFY_PERIOD=1 (период в минутах проверки уведомлений)
SHEDULES_CHECK_PERIOD=30 (период в минутах проверки изменений в расписании)
RASP_URL="https://ssau.ru" (сайт расписания, при работе с тестовым сервером необходимо поменять на его адрес, обычно http://127.0.0.1:5000)
```
Создаём файл `help.txt` и `start.txt` в корне и записываем туда любую справочную информацию и стартовое сообщение соответственно (можно оставить пустым, но наличие файла обязательно)

# Компиляция и запуск
Собираем исполняемый файл:

`go build main.go`

При необходимости, запускаем сервер с тестовым расписанием `ssau_server.py`

Запускаем бота:

`./main`

Далее происходит магия.

# Внесение правок
Я пока до конца не изучил процесс внесения правок в репозиторий от других пользователей.

Пока я это понял так, что пользователь делает форк репозитория себе, делает свои правки **в отдельной ветке**, а затем делает запрос на слияние своей ветки в мой репозиторий.

В любом случае, принимаю конструктивную критику, помощь в исправлении ошибок и legacy-кода, а также реализацию интересных идей.
